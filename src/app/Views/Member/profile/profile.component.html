<div class="container  ">
    <div class="card shadow-sm p-4">
        <div class="d-flex flex-column flex-md-row align-items-center">
            <div class="flex-grow-1">
                <div class="text-center d-block d-md-none me-md-4 mb-4 mb-md-0">
                    <img [src]="(member?.imagePath ? fullImgPath + member?.imagePath : '../../../../../assessts/user-avatar-male-5.png')"
                        alt="Profile Picture" class="rounded-circle border border-primary"
                        [ngStyle]="{'width': isNavbarVisible? '200px' : '100px', 'height': isNavbarVisible? '200px' : '100px'}"
                        style="width: 200px; height: 200px;" />

                    <h2 class=" fw-bold" [ngStyle]="{'color': isLightTheme ? '#dc3545' : 'white'}">{{member?.firstName
                        +" "+ member?.lastName}}</h2>
                    <!-- <button class="btn btn-danger mt-3 px-4 w-100">Logout</button> -->
                </div>

                <h4 class="fw-bold mb-4" [ngStyle]="{'color': isLightTheme ? '#b71c1c' : 'white'}">
                    My Profile
                </h4>
                <div class="container mt-3">
                    <div class="row">
                        <!-- Member Details Section (Left) -->
                        <div class="col-md-6">

                            <div class="card">
                                <div class="card-body">

                                    <div class="row mb-2">
                                        <div class="col-5"><strong class="text-primary">Name:</strong></div>
                                        <div class="col-6">{{ member?.firstName + " " + member?.lastName}}</div>
                                        <div class="col-1">
                                            <button (click)="editMember()" class="btn btn-outline-secondary border-0 px-3 edit-btn m-0 p-0"><i
                                                    class="bi bi-pen"  ></i></button>

                                        </div>
                                        <!-- Use safe navigation operator -->
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-5"><strong class="text-primary">Email:</strong></div>
                                        <div class="col-7">{{ member?.email }}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-5"><strong class="text-primary">Phone:</strong></div>
                                        <div class="col-7">{{ member?.phone }}</div>
                                    </div>
                                    <div class="row mb-2">
                                        <div class="col-5"><strong class="text-primary">Monthly Payment:</strong></div>
                                        <div class="col-7">{{ member?.monthlyPayment | currency : "LKR "}}</div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-5"><strong class="text-primary">Enroll Programs:</strong></div>
                                        <div class="col-7">{{ trainingPrograms.length }}</div>
                                    </div>

                                    <div class="row mb-2">
                                        <div class="col-5"><strong class="text-primary">Personalized plans:</strong>
                                        </div>
                                        <div class="col-7">{{ workoutPlans.length }}</div>
                                    </div>
                                </div>
                            </div>

                            <div class="training-programs-container mt-4 mt-lg-5">

                                <ul class="program-list">
                                    <h5 class="program-group-title">Personalized Plans</h5>
                                    <table class="table table-hover">
                                        <thead>
                                            <tr *ngIf="workoutPlans.length != 0">
                                                <th class="text-primary" scope="col">Workout Name</th>
                                                <th class="text-primary" scope="col">Reps Count</th>
                                                <th class="text-primary" scope="col">Weight (Kg)</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngIf="workoutPlans.length == 0">
                                                <td colspan="3" class="text-center fs-5 text-danger">No workout plans
                                                    available</td>
                                            </tr>
                                            <tr *ngFor="let workout of workoutPlans">
                                                <td>{{ workout.name }}</td>
                                                <td>{{ workout.repsCount }} Reps</td>
                                                <td>{{ workout.weight }} Kg</td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </ul>

                            </div>
                        </div>

                        <!-- Training Programs Section (Right) -->
                        <div class="col-md-6">
                            <div class="training-programs-container">
                                <!-- <h4>Training Programs</h4> -->
                                <div *ngFor="let programGroup of groupedTrainingPrograms" class="program-group">
                                    <!-- Group Header -->
                                    <h5 class="program-group-title">{{ programGroup.typeName }}</h5>
                                    <!-- Program List -->
                                    <ul class="program-list">
                                        <li *ngFor="let program of programGroup.programs" class="program-item">
                                            <div class="program-info">
                                                <span class="program-name">{{ program.programName }}</span>
                                                <span class="program-cost"><strong>Cost:</strong> ${{ program.cost
                                                    }}</span>
                                            </div>
                                            <!-- <p class="program-description">{{ program.description }}</p> -->
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- <div *ngIf="workoutPlans.length==0" class="col-md-6">
                            <div class="training-programs-container">
                           
                                <div *ngFor="let programGroup of groupedTrainingPrograms" class="program-group">
                                  
                                    <h5 class="program-group-title">{{ programGroup.typeName }}</h5>
                                  
                                    <ul class="program-list">
                                        <li *ngFor="let program of programGroup.programs" class="program-item">
                                            <div class="program-info">
                                                <span class="program-name">{{ program.programName }}</span>
                                                <span class="program-cost"><strong>Cost:</strong> ${{ program.cost
                                                    }}</span>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div> -->


                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
<ngx-spinner bdColor="rgba(0, 0, 0, 0.8)" size="medium" color="#fff" type="square-jelly-box" [fullScreen]="true">
    <p style="color: white"> Loading... </p>
</ngx-spinner>

<ng-template #memberFormTemplate>
    <div class="modal-header">
      <h4 class="modal-title pull-left  {{memberId ==0 ? 'text-success' : 'text-warning'}}">{{memberId ==0 ? 'Add New Member': 'Edit Member'}}</h4>
      <button type="button" class="close btn-close pull-right" aria-label="Close" (click)="modalRef?.hide()">
        <span aria-hidden="true" class="visually-hidden">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      <form [formGroup]="memberForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <!-- First Name -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="firstName" formControlName="firstName" class="form-control" placeholder="" />
                <label for="firstName" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">First Name <span *ngIf="isRequired('firstName')"
                    class="text-danger">*</span></label>
              </div>
              <div *ngIf="memberForm.get('firstName')?.invalid && memberForm.get('firstName')?.touched"
                class="text-danger">
                <div *ngIf="memberForm.get('firstName')?.hasError('required')">First name is required.</div>
              </div>
            </div>
          </div>
  
          <!-- Last Name -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="lastName" formControlName="lastName" class="form-control" placeholder="" />
                <label for="lastName" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Last Name <span *ngIf="isRequired('lastName')"
                    class="text-danger">*</span></label>
              </div>
              <div *ngIf="memberForm.get('lastName')?.invalid && memberForm.get('lastName')?.touched" class="text-danger">
                <div *ngIf="memberForm.get('lastName')?.hasError('required')">Last name is required.</div>
              </div>
            </div>
          </div>
  
          <!-- Email -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="email" formControlName="email" type="email" class="form-control" placeholder="" />
                <label for="email" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Email <span *ngIf="isRequired('email')"
                    class="text-danger">*</span></label>
              </div>
              <div *ngIf="memberForm.get('email')?.invalid && memberForm.get('email')?.touched" class="text-danger">
                <div *ngIf="memberForm.get('email')?.hasError('required')">Email is required.</div>
                <div *ngIf="memberForm.get('email')?.hasError('email')">Please enter a valid email address.</div>
              </div>
            </div>
          </div>
  
          <!-- NIC -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="nic" formControlName="NIC" class="form-control" placeholder="" />
                <label for="nic" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">NIC <span *ngIf="isRequired('NIC')"
                    class="text-danger">*</span></label>
              </div>
              <div *ngIf="memberForm.get('NIC')?.invalid && memberForm.get('NIC')?.touched" class="text-danger">
                <div *ngIf="memberForm.get('NIC')?.hasError('required')">NIC is required.</div>
                <div *ngIf="memberForm.get('NIC')?.hasError('pattern')">NIC must be 12 digits or 9 digits with 'x' or 'v'
                  at the end.</div>
              </div>
            </div>
          </div>
  
          <!-- Phone -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="phone" formControlName="phone" class="form-control" placeholder="" />
                <label for="phone" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Phone <span *ngIf="isRequired('phone')"
                    class="text-danger">*</span></label>
              </div>
              <div *ngIf="memberForm.get('phone')?.invalid && memberForm.get('phone')?.touched" class="text-danger">
                <div *ngIf="memberForm.get('phone')?.hasError('required')">Phone number is required.</div>
                <div *ngIf="memberForm.get('phone')?.hasError('pattern')">Phone number must be 10 digits.</div>
              </div>
            </div>
          </div>
  
          <!-- Date of Birth -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="dob" formControlName="doB" type="text" class="form-control" bsDatepicker
                  placeholder="Datepicker" />
                <label for="doB" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Date of Birth <span *ngIf="isRequired('doB')"
                    class="text-danger">*</span></label>
              </div>
              <div *ngIf="memberForm.get('doB')?.invalid && memberForm.get('doB')?.touched" class="text-danger">
                <div *ngIf="memberForm.get('doB')?.hasError('required')">Date of birth is required.</div>
                <div *ngIf="memberForm.get('doB')?.hasError('pastDate')">Date of birth must be in the past.</div>
              </div>
            </div>
          </div>
  
          <!-- Emergency Contact Name -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="emergencyContactName" formControlName="emergencyContactName" class="form-control"
                  placeholder="" />
                <label for="emergencyContactName" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Emergency Contact Name <span
                    *ngIf="isRequired('emergencyContactName')" class="text-danger">*</span></label>
              </div>
              <div
                *ngIf="memberForm.get('emergencyContactName')?.invalid && memberForm.get('emergencyContactName')?.touched"
                class="text-danger">
                <div *ngIf="memberForm.get('emergencyContactName')?.hasError('required')">Emergency contact name is
                  required.</div>
              </div>
            </div>
          </div>
  
          <!-- Emergency Contact Number -->
          <div class="col-12 col-md-6">
            <div class="form-group">
              <div class="input-wrapper">
                <input id="emergencyContactNumber" formControlName="emergencyContactNumber" class="form-control"
                  placeholder="" />
                <label for="emergencyContactNumber" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Emergency Contact Number <span
                    *ngIf="isRequired('emergencyContactNumber')" class="text-danger">*</span></label>
              </div>
              <div
                *ngIf="memberForm.get('emergencyContactNumber')?.invalid && memberForm.get('emergencyContactNumber')?.touched"
                class="text-danger">
                <div *ngIf="memberForm.get('emergencyContactNumber')?.hasError('required')">Emergency contact number is
                  required.</div>
                <div *ngIf="memberForm.get('emergencyContactNumber')?.hasError('pattern')">Emergency contact number must
                  be 10 digits.</div>
              </div>
            </div>
          </div>
  
  
          <!-- Address Section -->
          <div formGroupName=address class="col-12">
            <div class="form-group">
              <label class="text-muted">Address</label>
  
              <!-- Street -->
              <div class="row">
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <div class="input-wrapper">
                      <input id="street" formControlName="street" class="form-control" placeholder="" />
                      <label for="street" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Street <span *ngIf="isRequired('address.street')"
                          class="text-danger">*</span></label>
                    </div>
                  </div>
                </div>
  
                <!-- City -->
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <div class="input-wrapper">
                      <input id="city" formControlName="city" class="form-control" placeholder="" />
                      <label for="city" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">City <span *ngIf="isRequired('address.city')"
                          class="text-danger">*</span></label>
                    </div>
                  </div>
                </div>
  
                <!-- Province -->
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <div class="input-wrapper">
                      <input id="province" formControlName="province" class="form-control" placeholder="" />
                      <label for="province" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Province <span *ngIf="isRequired('address.province')"
                          class="text-danger">*</span></label>
                    </div>
                  </div>
                </div>
  
                <!-- Country -->
                <div class="col-12 col-md-6">
                  <div class="form-group">
                    <div class="input-wrapper">
                      <input id="country" formControlName="country" class="form-control" placeholder="" />
                      <label for="country" class="floating-label" [ngStyle]="{ 'background-color': getLabelBackground() }">Country <span *ngIf="isRequired('address.country')"
                          class="text-danger">*</span></label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
  
          <div class="col-12">
            <div class="form-group">
              <label for="imageFile" class="text-muted" [ngStyle]="{ 'background-color': getLabelBackground() }">Profile Image <span *ngIf="isRequired('imageFile')"
                  class="text-danger">*</span></label>
              <input id="imageFile" type="file" (change)="onFileChange($event)" class="form-control" />
              <div *ngIf="memberForm.get('imageFile')?.invalid && memberForm.get('imageFile')?.touched"
                class="text-danger">
                <div *ngIf="memberForm.get('imageFile')?.hasError('required')">Profile image is required.
                </div>
              </div>
            </div>
          </div>
  
          <!-- Submit Button -->
          <div class="col-12">
            <div class="form-group">
              <button type="submit" class="btn {{memberId ==0 ? 'btn-success' : 'btn-warning'}}">{{memberId ==0 ? 'Add Member': 'Edit Member'}}</button>
            </div>
          </div>
        </div>
      </form>
    </div>
  </ng-template>